from PIL import Image, ImageGrab
from pynput.mouse import Button, Controller
import time
import random


plans = [{
    ((253, 243, 219), (251, 225, 184), (248, 225, 187), (244, 213, 167), (241, 209, 164), (251, 225, 184)): 0,
    ((253, 243, 219), (251, 225, 184), (248, 225, 187), (212, 179, 142), (235, 203, 157), (187, 156, 120)): 1,
    ((253, 244, 220), (251, 225, 184), (248, 225, 187), (244, 213, 167), (201, 167, 130), (238, 211, 172)): 2,
    ((253, 243, 219), (110, 73, 59), (248, 225, 187), (244, 213, 167), (241, 209, 164), (238, 211, 172)): 3,
    ((253, 243, 220), (120, 80, 60), (227, 201, 167), (225, 189, 145), (211, 179, 142), (247, 221, 181)): 4,
    ((253, 243, 220), (108, 71, 57), (190, 162, 134), (153, 117, 91), (241, 209, 164), (236, 209, 171)): 5
}, {
    ((253, 244, 220), (246, 219, 179), (248, 225, 187), (244, 213, 167), (241, 209, 164), (251, 225, 184)): 0,
    ((253, 243, 219), (251, 225, 184), (248, 225, 187), (244, 213, 167), (118, 79, 61), (124, 89, 71)): 1,
    ((253, 243, 220), (207, 178, 145), (248, 225, 187), (244, 213, 167), (241, 209, 164), (234, 207, 169)): 2,
    ((253, 243, 220), (213, 179, 140), (113, 78, 64), (152, 115, 90), (241, 209, 164), (251, 225, 184)): 3,
    ((253, 243, 219), (156, 116, 87), (148, 111, 84), (112, 74, 55), (184, 142, 97), (138, 104, 83)): 4,
    ((253, 243, 219), (174, 142, 116), (248, 225, 187), (136, 100, 78), (65, 24, 18), (168, 136, 110)): 5
}, {
    ((253, 243, 219), (251, 225, 184), (247, 224, 186), (244, 213, 167), (161, 125, 97), (251, 225, 184)): 0,
    ((253, 243, 219), (155, 122, 99), (248, 225, 187), (244, 213, 167), (187, 151, 114), (198, 165, 129)): 1,
    ((253, 243, 220), (251, 225, 184), (248, 225, 187), (244, 213, 167), (222, 189, 148), (251, 225, 184)): 2,
    ((253, 243, 220), (175, 143, 112), (219, 193, 160), (244, 213, 167), (241, 209, 164), (251, 225, 184)): 3,
    ((253, 244, 220), (187, 155, 121), (152, 114, 90), (187, 154, 114), (236, 204, 160), (162, 122, 87)): 4,
    ((253, 243, 219), (136, 101, 82), (160, 129, 106), (244, 213, 167), (219, 186, 146), (130, 98, 85)): 5
}]

positions = {
    0: (924, 410),
    1: (1052, 410),
    2: (1180, 410),
    3: (924, 538),
    4: (1052, 538),
    5: (1180, 538)
}


def move_puzzle(from_, to_, array):
    print(from_, to_)
    temp = array[from_]
    array[from_] = array[to_]
    array[to_] = temp

    mouse = Controller()
    mouse.position = positions[from_]
    mouse.press(Button.left)
    mouse.position = positions[to_]
    mouse.release(Button.left)


def press_ok():
    mouse = Controller()
    mouse.position = (760, 480)
    mouse.click(Button.left)


def choose_palette(colors):
    selected = 0
    for plan in plans:
        didBreak = False
        for color in colors:
            if color not in plan:
                didBreak = True
                break

        if not didBreak:
            selected = plan
            break

    return [selected[color] for color in colors]


def try_resolve():
    im = Image.open('img/try44.PNG')
    pix = im.load()
    im.putpixel((840, 340), (255, 0, 0))

    colors = []

    for j in range(2):
        for i in range(3):
            piks = []
            for a in range(6):

                x = 924 + i * 128
                y = 348 + j * 128 + a*16

                color = pix[x, y][0:3]
                piks.append(color)

            print(piks)
    #         colors.append(tuple(piks))

    # colors = choose_palette(colors)

    # while colors != [0, 1, 2, 3, 4, 5]:
    #     for i, c in enumerate(colors):
    #         if i == c:
    #             continue

    #         move_puzzle(i, c, colors)
    #         time.sleep(5)

    # press_ok()


try_resolve()
